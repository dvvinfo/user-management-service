# План разработки сервиса работы с пользователями

## Технологии
- **Runtime**: Node.js
- **Язык**: TypeScript
- **Framework**: Express
- **СУБД**: PostgreSQL
- **ORM**: Prisma
- **Авторизация**: JWT (JSON Web Tokens)
- **Хеширование паролей**: bcrypt

## Структура проекта
```
src/
├── config/          # Конфигурация приложения
├── controllers/     # Контроллеры для обработки запросов
├── middlewares/     # Middleware (авторизация, валидация)
├── routes/          # Определение маршрутов
├── services/        # Бизнес-логика
├── types/           # TypeScript типы и интерфейсы
├── utils/           # Вспомогательные функции
├── validators/      # Валидация входных данных
└── index.ts         # Точка входа приложения
prisma/
├── schema.prisma    # Prisma схема БД
└── migrations/      # Миграции БД
```

## Этапы разработки

### Этап 1: Инициализация проекта
- [x] Создание структуры папок
- [ ] Инициализация npm проекта
- [ ] Установка зависимостей
- [ ] Настройка TypeScript
- [ ] Настройка Prisma
- [ ] Создание .env файла

### Этап 2: Настройка базы данных
- [ ] Создание Prisma схемы для модели User
- [ ] Генерация миграций
- [ ] Применение миграций

### Этап 3: Реализация базовой структуры
- [ ] Создание типов и интерфейсов
- [ ] Настройка Express сервера
- [ ] Создание базовых middleware (error handler, logger)

### Этап 4: Реализация сервисов и контроллеров
- [ ] UserService - бизнес-логика работы с пользователями
- [ ] AuthService - логика авторизации и JWT
- [ ] UserController - обработка HTTP запросов
- [ ] AuthController - обработка авторизации/регистрации

### Этап 5: Реализация endpoints
1. **POST /api/auth/register** - Регистрация пользователя
2. **POST /api/auth/login** - Авторизация пользователя
3. **GET /api/users/:id** - Получение пользователя по ID
4. **GET /api/users** - Получение списка пользователей (admin)
5. **PATCH /api/users/:id/block** - Блокировка пользователя

### Этап 6: Middleware и валидация
- [ ] Middleware авторизации (проверка JWT)
- [ ] Middleware проверки ролей (admin/user)
- [ ] Валидация входных данных (email, пароль и т.д.)

### Этап 7: Тестирование и финализация
- [ ] Тестирование всех endpoints
- [ ] Создание README с документацией API
- [ ] Проверка безопасности

## Модель User

```typescript
{
  id: string (UUID)
  fullName: string         // ФИО
  birthDate: Date          // Дата рождения
  email: string (unique)   // Email
  password: string         // Хешированный пароль
  role: 'admin' | 'user'   // Роль
  isActive: boolean        // Статус активности
  createdAt: Date
  updatedAt: Date
}
```

## Правила доступа

### GET /api/users/:id
- ✅ Админ может получить любого пользователя
- ✅ Пользователь может получить только свои данные
- ❌ Неавторизованные пользователи не имеют доступа

### GET /api/users
- ✅ Только админ
- ❌ Обычные пользователи не имеют доступа

### PATCH /api/users/:id/block
- ✅ Админ может заблокировать любого пользователя
- ✅ Пользователь может заблокировать сам себя
- ❌ Пользователь не может блокировать других

## Безопасность
- Пароли хешируются с использованием bcrypt
- JWT токены для аутентификации
- Валидация всех входных данных
- Защита от SQL-инъекций (через Prisma)
- CORS настройка
- Rate limiting (опционально)
